---
When to 반정규화?


처음 erd 만들 때 반정규화 앵간하면 하지 말자.
어짜피 초반에 스키마, 엔티티 휙휙 바뀌기도 하거니에와 
나중에 scalability를 위한 확장 가능한 설계 해주는게 좋다.

반정규화의 목적이 스키마 일관성 깨서라도 성능 올리자인데,
성능 올리는건 query tuning이나 캐싱으로 하고,
모델링은 앵간하면 유연하고 확장 가능하게 하자.


---
what is 반정규화?

normalization의 목적은 db를 최대한 atomic하게 쪼개서 중복 데이터 없애서 메모리 아끼려고.

반정규화의 목적은 총 게시글 갯수, 게시글당 좋아요 갯수 이런 애들까지 세세히 쪼개면 자주 query해서 join하고 orderby, groupby 하는데 너무 비효율적이니,
이런 특수한 상황인 애들만 정규화 깨자는 것.




---
case1) join 안쓰려고 


게시판->게시물에서, 정규화 하면 게시물에 유저아이디 없어야겠지?
근데 매번 게시물 로드할 때 join USER하면 query 속도 느려지고,
게시물 update, delete할 때 Transaction으로 USER 테이블 막히니까, 
반 정규화 해서 유저 아이디를 게시물에 포함시키는 것


---
case2) 정렬(ORDER BY, SORT BY) 안쓰려고 


인기게시물 top 10 페이지는, 
매번 모든 게시물 full table scan 떠서 
sort by 조회수, 좋아요 해야하는데, 계산 부하가 너무 크니까,

스케쥴러에 20~30분 단위로 sort by 조회수 LIMIT 10 한 결과값을 담은 엔티티를 한번씩 업데이트 시킨 후,
인기게시물 top 10 페이지는 해당 엔티티에서 SELECT * 해서 가져가게 하면,
매번 SORT BY 안해도 되지. 개꿀~



---
결론)

insert, update, delete 같은 transaction 걸리는 애들이나,
JOIN 많이 해야하는 애들이나(얘는 그나마 양반),
SORT BY, GROUP BY 같이 풀스캔 한 뒤 요리하는 애들은
매번 연산하는거 개오바니까,
반정규화 해서 엔티티 따로 빼서 거기에서 결과값 일괄관리하자.